@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  html.dark {
    background-color: #000000;
  }
  
  html.dark body {
    background-color: #000000;
    color: #ffffff;
  }
  
  body {
    transition: background-color 0.3s ease, color 0.3s ease;
  }
  
}

/* Progress Bar Animation */
@keyframes progress {
  0% {
    left: -25%;
    width: 25%;
  }
  50% {
    left: 100%;
    width: 25%;
  }
  100% {
    left: 100%;
    width: 25%;
  }
}

.animate-progress {
  animation: progress 2.5s ease-in-out infinite;
}

/* Fade in animation for success badge */
@keyframes fade-in {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-fade-in {
  animation: fade-in 0.3s ease-out;
}

/* Print styles */
@page {
  /* Margin cho trang in - tăng margin-bottom để có chỗ cho footer */
  margin: 0.5in 0.5in 0.7in 0.5in;
  /* Ngăn trang trống ở cuối */
  size: auto;
}

@media print {
  /* Ẩn hoàn toàn header và tất cả logos.png khi in */
  header,
  header *,
  img[src*="logos.png"],
  img[src*="/logos/logos.png"] {
    display: none !important;
    visibility: hidden !important;
  }
  
  /* Ẩn tất cả các phần không cần thiết */
  header > div:nth-child(2),
  header > div:nth-child(3),
  button[aria-label="Mở rộng sidebar"],
  button[aria-label="Thu gọn sidebar"],
  .fixed.left-0,
  .fixed.bottom-8.right-8,
  button[aria-label="Nộp bài"],
  button[aria-label="Hỏi đáp Hack"],
  button[aria-label="Giải phẫu 3D"],
  button[aria-label="In"],
  button[aria-label="Kiểm tra"],
  .fixed.inset-0.bg-black,
  .fixed.bottom-8.left-1\/2,
  /* Ẩn divider resize */
  .cursor-col-resize,
  /* Ẩn modal zoom */
  .fixed.inset-0.z-\[100\],
  /* Ẩn các button trong câu hỏi (buttons sau khi verify) */
  .mb-6.flex.items-center.justify-between,
  /* Ẩn icon gửi và verify icon trong textarea */
  button[aria-label="Gửi câu trả lời"],
  .absolute.top-1\/2.right-6,
  .absolute.top-3.right-12,
  .absolute.top-3.right-3 {
    display: none !important;
  }

  /* Ẩn split panels - ẩn panel bên phải (có minWidth và maxWidth trong style) */
  div[style*="minWidth"],
  div[style*="maxWidth"] {
    display: none !important;
  }
  
  /* Đảm bảo content chính full width và loại bỏ height cố định */
  div[class*="flex-1"][class*="overflow-y-auto"],
  div[class*="overflow-y-auto"],
  div[class*="h-full"] {
    width: 100% !important;
    height: auto !important;
    min-height: auto !important;
    max-height: none !important;
    overflow: visible !important;
  }
  
  /* Đảm bảo container không bị ảnh hưởng */
  div[ref] {
    margin-left: 0 !important;
  }

  /* Đảm bảo main content không bị ảnh hưởng bởi header đã bị ẩn */
  main {
    margin-top: 0 !important;
    padding-top: 0.5in !important;
    background: white !important;
    position: relative !important;
    z-index: 0 !important;
  }
  
  body {
    padding-top: 0 !important;
    position: relative !important;
  }
  
  .max-w-6xl,
  #questions-scroll-container {
    position: relative !important;
    z-index: 0 !important;
    margin-top: 0 !important;
  }
  
  .p-8:first-of-type {
    margin-top: 0 !important;
    padding-top: 0.25rem !important;
  }
  
  .max-w-6xl {
    padding-top: 0 !important;
  }
  
  #questions-scroll-container {
    margin-top: 0 !important;
    padding-top: 0 !important;
  }

  /* Body và container */
  body {
    background: white !important;
    color: black !important;
  }

  .min-h-screen {
    min-height: auto !important;
  }

  /* Sidebar - ẩn hoàn toàn */
  .fixed.left-0,
  .fixed.left-4 {
    display: none !important;
  }

  /* Content area - full width */
  div[class*="ml-\["] {
    margin-left: 0 !important;
  }

  /* Chia trang thành 2 cột để tiết kiệm giấy - điều chỉnh để tránh trang trống */
  #questions-scroll-container {
    column-count: 2 !important;
    column-gap: 1.5rem !important;
    column-fill: balance !important; /* Thay đổi từ auto sang balance */
    column-rule: none !important;
    width: 100% !important;
    height: auto !important;
    min-height: auto !important;
    max-height: none !important;
    /* Điều chỉnh orphans và widows để tránh trang trống */
    orphans: 2 !important;
    widows: 2 !important;
    /* Đảm bảo không có break không cần thiết */
    break-inside: auto !important;
    page-break-inside: auto !important;
  }
  
  /* Đảm bảo mỗi câu hỏi không bị break không đúng */
  #questions-scroll-container > div {
    break-inside: avoid !important;
    page-break-inside: avoid !important;
    /* Cho phép break sau câu hỏi nhưng không tạo trang trống */
    break-after: auto !important;
    page-break-after: auto !important;
    /* Đảm bảo không có margin/padding thừa tạo không gian */
    margin-bottom: 0.5rem !important;
  }
  
  /* Đảm bảo phần tử cuối cùng trong container không tạo trang trống */
  #questions-scroll-container > div:last-child {
    margin-bottom: 0 !important;
    break-after: auto !important;
    page-break-after: auto !important;
  }
  
  /* Đảm bảo container column không có height thừa */
  #questions-scroll-container::after {
    content: "" !important;
    display: none !important;
  }

  /* Câu hỏi - style basic, giảm padding và margin, đảm bảo không bị đè bởi logo */
  .p-8 {
    padding: 0.25rem 0.5rem !important;
    margin-bottom: 0.5rem !important;
    margin-top: 0 !important;
    page-break-inside: avoid;
    break-inside: avoid;
    display: block !important;
    position: relative !important;
    z-index: 0 !important;
  }

  /* Câu hỏi số - inline với câu hỏi, không xuống dòng */
  .text-xl.font-bold {
    font-size: 0.75rem !important;
    font-weight: 600 !important;
    color: #000 !important;
    margin: 0 !important;
    display: inline !important;
    white-space: nowrap !important;
  }

  /* Tiêu đề câu hỏi - inline với câu số, cùng dòng, không bị cắt */
  h2.text-lg {
    font-size: 0.75rem !important;
    font-weight: 600 !important;
    color: #000 !important;
    margin: 0 0 0 0.25rem !important;
    display: inline !important;
    line-height: 1.3 !important;
    word-wrap: break-word !important;
    word-break: break-word !important;
    overflow-wrap: break-word !important;
    white-space: normal !important;
  }
  
  /* Đảm bảo câu số và câu hỏi không xuống dòng */
  .p-8 > span:first-child + h2 {
    display: inline !important;
  }

  /* Message khi verify - ẩn */
  .mb-6 > p.text-lg {
    display: none !important;
  }

  /* Giải thích tham khảo - ẩn */
  .mb-6 > div.flex.items-start,
  .mb-6 > div.grid {
    display: none !important;
  }

  /* Options - bỏ border và padding, khoảng cách tối thiểu (như chỉ xuống dòng) */
  .space-y-3 > button,
  .space-y-3 > div,
  button[class*="rounded-2xl"][class*="border-2"],
  button[class*="border-2"] {
    page-break-inside: avoid;
    break-inside: avoid;
    margin-bottom: 0.1rem !important;
    margin-top: 0 !important;
    padding: 0 !important;
    border: none !important;
    border-width: 0 !important;
    border-style: none !important;
    border-color: transparent !important;
    border-radius: 0 !important;
    background: transparent !important;
    color: #000 !important;
    box-shadow: none !important;
    display: block !important;
    word-wrap: break-word !important;
    word-break: break-word !important;
    overflow-wrap: break-word !important;
    hyphens: auto !important;
  }

  /* Text trong options - font nhỏ hơn, không bị cắt chữ */
  .space-y-3 button span,
  .space-y-3 button div {
    color: #000 !important;
    font-size: 0.7rem !important;
    line-height: 1.3 !important;
    word-wrap: break-word !important;
    word-break: break-word !important;
    overflow-wrap: break-word !important;
    white-space: normal !important;
  }
  
  /* Container options - giảm khoảng cách tối đa, đảm bảo nằm dưới ảnh */
  .space-y-3 {
    margin-top: 0.5rem !important;
    margin-bottom: 0.25rem !important;
    position: static !important;
    float: none !important;
    clear: both !important;
    z-index: auto !important;
  }
  
  /* Option letter và text cùng dòng, không bị cắt */
  .space-y-3 button > div {
    display: inline !important;
    white-space: normal !important;
    word-wrap: break-word !important;
  }
  
  .space-y-3 button > div > span:first-child {
    margin-right: 0.25rem !important;
    white-space: nowrap !important;
  }
  
  /* Đảm bảo text của phương án không bị cắt */
  .space-y-3 button > div > span:last-child,
  .space-y-3 button > div > span:nth-child(2) {
    white-space: normal !important;
    word-break: break-word !important;
  }

  /* Ẩn verify icons */
  .w-5.h-5.rounded-full,
  .w-6.h-6.rounded-full {
    display: none !important;
  }

  /* Textarea cho essay - style basic, font nhỏ */
  textarea {
    border: 1px solid #d1d5db !important;
    border-radius: 0.25rem !important;
    padding: 0.25rem !important;
    background: white !important;
    color: #000 !important;
    font-size: 0.7rem !important;
    min-height: 40px !important;
    max-height: 60px !important;
    margin-top: 0.25rem !important;
  }

  /* Container ảnh - nằm dưới câu hỏi, trên phương án */
  .mb-6.flex.justify-center {
    margin: 0.25rem 0 0.5rem 0 !important;
    margin-bottom: 0.5rem !important;
    display: block !important;
    text-align: center !important;
    position: static !important;
    float: none !important;
    z-index: auto !important;
    page-break-inside: avoid !important;
    break-inside: avoid !important;
    clear: both !important;
  }
  
  /* Ảnh trong câu hỏi - nhỏ lại, nằm dưới câu hỏi, trên phương án */
  .relative.w-full.aspect-video,
  .relative.w-full.max-w-2xl.aspect-video,
  .mb-6.flex.justify-center .relative {
    width: 100% !important;
    max-width: 100% !important;
    height: auto !important;
    aspect-ratio: auto !important;
    min-height: 60px !important;
    max-height: 100px !important;
    margin: 0 auto 0.5rem auto !important;
    display: block !important;
    position: static !important;
    float: none !important;
    z-index: auto !important;
    clear: both !important;
  }
  
  /* Ảnh Image component - đảm bảo không đè lên */
  .mb-6.flex.justify-center img,
  .relative.w-full.aspect-video img,
  .relative.w-full.max-w-2xl.aspect-video img,
  .mb-6.flex.justify-center .relative img {
    width: 100% !important;
    height: auto !important;
    max-height: 100px !important;
    object-fit: contain !important;
    position: static !important;
    display: block !important;
    float: none !important;
    z-index: auto !important;
    clear: both !important;
  }
  

  /* Đảm bảo tất cả câu hỏi hiển thị (đã định nghĩa ở trên) */

  /* Container chính */
  .max-w-6xl {
    max-width: 100% !important;
  }

  /* Scroll container - loại bỏ hoàn toàn */
  .overflow-y-auto,
  [class*="overflow"] {
    overflow: visible !important;
    height: auto !important;
    min-height: auto !important;
    max-height: none !important;
  }

  /* Flex container - loại bỏ height cố định */
  .flex.h-\[calc\(100vh-5rem\)\],
  div[class*="h-\[calc\(100vh"],
  div[class*="h-[calc(100vh"] {
    height: auto !important;
    min-height: auto !important;
    max-height: none !important;
    flex-direction: column !important;
  }
  
  /* Tất cả các container có height viewport */
  [class*="h-[calc"],
  [class*="h-\[calc"] {
    height: auto !important;
    min-height: auto !important;
    max-height: none !important;
  }

  /* Page breaks - giảm margin tối đa */
  .p-8.mb-6 {
    page-break-inside: avoid;
    break-inside: avoid;
    margin-bottom: 0.5rem !important;
  }
  
  /* Giảm khoảng cách giữa các phần tử trong câu hỏi */
  .mb-6 {
    margin-bottom: 0.25rem !important;
  }
  
  .mb-4 {
    margin-bottom: 0.2rem !important;
  }
  
  /* Container câu hỏi chính - đã xử lý break ở trên */
  #questions-scroll-container > div {
    margin-bottom: 0.5rem !important;
  }
  
  /* Giảm font size tổng thể */
  body {
    font-size: 0.75rem !important;
  }
  
  /* Đảm bảo không có khoảng cách thừa */
  .p-8 > *:first-child {
    margin-top: 0 !important;
  }
  
  .p-8 > *:last-child {
    margin-bottom: 0 !important;
  }

  /* Ẩn dark mode styles khi in */
  .dark\:bg-black,
  .dark\:text-white,
  .dark\:text-gray-200,
  .dark\:text-gray-300,
  .dark\:bg-gray-800 {
    background: white !important;
    color: #000 !important;
  }

  /* Đảm bảo text luôn màu đen khi in (trừ ảnh) */
  *:not(img):not(svg) {
    color: #000 !important;
  }

  /* Ẩn các phần tử có background màu (trừ ảnh) */
  [style*="background-color"]:not(img):not(svg),
  [style*="backgroundColor"]:not(img):not(svg) {
    background: white !important;
  }

  /* Đảm bảo tất cả options không có border khi in - override cả inline styles */
  button[class*="rounded-2xl"],
  button[class*="border-2"],
  button[class*="border"],
  button[style*="border"],
  button[style*="borderColor"],
  button[style*="border-color"] {
    border: none !important;
    border-width: 0 !important;
    border-style: none !important;
    border-color: transparent !important;
    background: transparent !important;
    color: #000 !important;
  }
  
  /* Override tất cả inline border styles */
  button[style] {
    border: none !important;
    border-width: 0 !important;
  }

  /* Ẩn các phần tử có màu sắc phức tạp và đảm bảo không có border */
  [style*="#00C800"],
  [style*="#EC5300"],
  [style*="#8D7EF7"],
  [style*="#41C911"],
  [style*="#E05B00"],
  [style*="borderColor"],
  [style*="border-color"] {
    background: white !important;
    border: none !important;
    border-width: 0 !important;
    border-color: transparent !important;
    color: #000 !important;
  }

  /* Đảm bảo images hiển thị đúng */
  img {
    max-width: 100% !important;
    height: auto !important;
  }

  /* Hiển thị footer trên mọi trang khi in - dùng position fixed nhưng đảm bảo không tạo trang trống */
  .print-footer {
    display: flex !important;
    justify-content: space-between !important;
    align-items: center !important;
    width: 100% !important;
    padding: 0.25rem 0.15in !important;
    margin: 0 !important;
    position: fixed !important;
    bottom: 0 !important;
    left: 0 !important;
    right: 0 !important;
    background: transparent !important;
    font-size: 0.7rem !important;
    z-index: 9999 !important;
    /* Đảm bảo footer không tạo không gian thừa */
    height: auto !important;
    min-height: 0 !important;
    max-height: 0.2in !important;
    /* Đảm bảo footer luôn hiển thị */
    visibility: visible !important;
    opacity: 1 !important;
    /* Không tạo page break */
    page-break-inside: avoid !important;
    break-inside: avoid !important;
  }
  
  .print-footer span {
    color: #8D7EF7 !important;
    font-weight: bold !important;
    display: block !important;
  }
  
  .print-footer span:first-child {
    text-align: left !important;
  }
  
  .print-footer span:last-child {
    text-align: right !important;
  }

  /* Thêm padding-bottom cho content để không bị che bởi footer fixed */
  main {
    padding-bottom: 0.3in !important;
    margin-bottom: 0 !important;
  }
  
  /* Đảm bảo content không bị che bởi footer */
  #questions-scroll-container {
    padding-bottom: 0.3in !important;
    margin-bottom: 0 !important;
  }
  
  .max-w-6xl {
    padding-bottom: 0 !important;
    margin-bottom: 0 !important;
  }

  /* Ngăn chặn trang trống ở cuối */
  body {
    height: auto !important;
    min-height: auto !important;
    margin: 0 !important;
    padding: 0 !important;
  }

  html {
    height: auto !important;
    margin: 0 !important;
    padding: 0 !important;
  }

  /* Đảm bảo không có khoảng trống thừa ở cuối */
  .min-h-screen {
    min-height: auto !important;
    height: auto !important;
  }

  /* Ngăn page break sau phần tử cuối cùng */
  #questions-scroll-container > div:last-child {
    page-break-after: auto !important;
    break-after: auto !important;
    margin-bottom: 0 !important;
  }

  /* Đảm bảo không có khoảng trống sau content cuối */
  main > div:last-child,
  .max-w-6xl > div:last-child {
    margin-bottom: 0 !important;
    padding-bottom: 0 !important;
  }

  /* Loại bỏ khoảng trống thừa từ flex containers */
  .flex.h-\[calc\(100vh-5rem\)\] > div:last-child,
  div[class*="flex"] > div:last-child {
    margin-bottom: 0 !important;
    padding-bottom: 0 !important;
  }
  
  /* Đảm bảo tất cả các phần tử cuối cùng không có margin/padding */
  main > *:last-child,
  body > *:last-child,
  #questions-scroll-container > *:last-child {
    margin-bottom: 0 !important;
    padding-bottom: 0 !important;
  }
  
  /* Loại bỏ tất cả height cố định từ các container chính */
  main,
  body > div,
  body > div > div {
    height: auto !important;
    min-height: auto !important;
    max-height: none !important;
  }
  
  /* Đảm bảo column layout không tạo trang trống */
  #questions-scroll-container {
    height: auto !important;
    min-height: auto !important;
    max-height: none !important;
    /* Đảm bảo column không tạo không gian thừa */
    display: block !important;
    position: relative !important;
  }
  
  /* Loại bỏ bất kỳ pseudo-element nào có thể tạo không gian */
  #questions-scroll-container::before,
  #questions-scroll-container::after {
    display: none !important;
    content: none !important;
    height: 0 !important;
    width: 0 !important;
  }
  
  /* Loại bỏ tất cả các phần tử có thể tạo không gian thừa */
  * {
    box-sizing: border-box !important;
  }
  
  /* Đảm bảo không có phần tử nào có height lớn hơn nội dung */
  div[class*="overflow"],
  div[class*="h-"],
  div[class*="h-full"],
  div[class*="h-screen"],
  section,
  article,
  /* Đặc biệt xử lý các class Tailwind có thể tạo height */
  [class*="h-\["],
  [class*="h-\[calc"] {
    height: auto !important;
    min-height: auto !important;
    max-height: none !important;
  }
  
  /* Đảm bảo tất cả div không có height cố định */
  div {
    max-height: none !important;
  }
  
  /* Loại bỏ height từ style inline nếu có */
  [style*="height"],
  [style*="Height"] {
    height: auto !important;
  }
  
  /* Loại bỏ margin và padding không cần thiết từ body và html */
  html, body {
    margin: 0 !important;
    padding: 0 !important;
    height: auto !important;
    min-height: auto !important;
  }
  
  /* Đảm bảo container chính không có height cố định */
  div.min-h-screen,
  div[class*="min-h"] {
    min-height: auto !important;
    height: auto !important;
  }
  
  /* QUAN TRỌNG: Đảm bảo tất cả các container chính không có height lớn hơn nội dung */
  body > div,
  body > div > main,
  body > div > main > div,
  body > div > main > div > div {
    height: auto !important;
    min-height: auto !important;
    max-height: none !important;
  }
  
  /* Đảm bảo không có phần tử nào có position fixed/absolute tạo không gian - chỉ ẩn các phần tử đã được định nghĩa ở trên */
  /* Không cần thêm quy tắc ở đây vì đã ẩn ở trên */
  
  /* Đảm bảo main và các container chính */
  main,
  main > div,
  main > div > div {
    position: static !important;
    height: auto !important;
    min-height: auto !important;
    max-height: none !important;
  }
}

/* Ẩn footer khi không in */
.print-footer {
  display: none;
}

/* Fix Error Panel styles */
.fix-error-textarea::placeholder {
  color: #00000040;
}

